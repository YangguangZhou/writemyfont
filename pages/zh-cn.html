<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>手写字体生成器 by 字嗨</title>
	<link rel="stylesheet" href="style.css">
</head>
<body lang="zh-CN">
	<nav id="language-switch">
		<a href="index.html">繁体中文</a>
		<a href="zh-cn.html" class="active">简体中文</a>
		<a href="ja.html">日本語</a>
	</nav>
	<div id="list-container">
		<label for="listSelect">字表：</label>
		<select id="listSelect"></select>
		<span class="butt" id="canvasListButton">👓</span>
		<span class="butt" id="findButton">🔍</span>
    </div>

    <div id="demo-container">
		<span id="glyphName"></span>
		<span id="charSeq"></span>
		<span id="glyphNote"></span>
		<span class="butt" id="prevButton">👈</span>
		<span class="butt" id="nextButton">👉</span>
    </div>
	<div id="canvas-container">
        <canvas id="gridCanvas" width="500" height="500"></canvas>
        <canvas id="drawingCanvas" width="500" height="500"></canvas>
    </div>

	<div id="slider-container">
		<div id="brushSelector"></div><div id="pressureButton" class="off"></div>
		<span class="butt use" id="penButton">🖌️</span><span class="butt" id="eraserButton">🚿</span>
		<input id="lineWidthSlider" type="range" min="2" max="36" value="12" />
		<label for="lineWidthSlider"><span id="lineWidthValue">12</span></label>
	</div>

	<div id="button-container">
		<span class="butt" id="clearButton">🚮</span>
		<span class="butt" id="moveLeftButton">⬅️</span>
		<span class="butt" id="moveRightButton">➡️</span>
		<span class="butt" id="moveUpButton">⬆️</span>
		<span class="butt" id="moveDownButton">⬇️</span>
		<span class="butt" id="undoButton">↩️</span>
    </div>

	<div id="navi-container">
		<span class="butt" id="hintButton">💡</span>
		<span class="butt" id="settingButton">⚙️</span>
		<span id="spanDoneCount">-</span>
		<span class="butt" id="downloadButton">💾</span>
    </div>
	<div id="progress-container">
		<progress id="progress-bar" value="0" max="100"></progress>
		<span id="progress-text">0%</span>
	</div>

	<div id="listup-container" class="dialog">
		<div class="dialog-body">
			<span id="closeListupButton" class="close">×</span>
			<h2>字符列表</h2>
			<div id="listup-body"></div>
		</div>
	</div>

	<div id="hint-container" class="dialog">
		<div class="dialog-body">
			<span id="closeHintButton" class="close">×</span>
			<h2>提示 Ver <span id="version"></span></h2>
			<ul id="hintContent">
				<li>本工具由「<a href="https://zi-hi.com" target="_blank">字嗨！</a>」提供。</li>
				<li>书写的字表来自「<a href="https://justfont.com/jf7000" target="_blank">jf7000当务字集</a>」。</li>
				<li>由于所有数据储存在您浏览器本地端，若担心被浏览器清除，建议定期用导出功能备份数据。</li>
				<li>建议每个字写好后，就立刻调整位置（汉字原则上置中），这样可避免事后调整困难。</li>
				<li>半形文字一律输出成比例宽，故水平方向位置会被忽略。背景的红线是基线的参考位置。</li>
				<li>全形的英数字会使用半形英数字自动产生。</li>
				<li>当所需的字符齐全时，系统会自动处理直排、组合文字的设置。</li>
				<li>请注意因为技术的限制，目前本系统所产生的OTF档案，虽可勉强安装运作，但并非正确的CID格式，可能在Adobe软件无法正确识别为CJK字体。</li>
				<li>本服务所生成的字体档，若使用上造成任何影响，本服务与作者不负任何责任。</li>
				<li>本系统并未搜集任何用户笔迹或其他用户信息。但若要公开您的字体档时，请自行评估笔迹公开的风险。</li>
				<li>本工具不定期更新，虽然力求尽可能支援先前的版本，但要维护多种旧机制相各种环境有所困难，难以尽善尽美。由于所有版本程式码都是开源的，可自行从GitHub上使用。若有技术支援需求，可与作者联络（可能须付费）。</li>
				<li>本专案GitHub页面在<a href="https://github.com/ButTaiwan/writemyfont" target="_blank">这里</a>，在此可查阅更多信息。<p class="dummy"></p></li>
			</ul>
		</div>
	</div>

	<div id="settings-container" class="dialog">
		<div class="dialog-body">
			<span id="closeSettingsButton" class="close">×</span>
			<h2 id="settings-title">设置</h2>
			<span class="note" id="span-welcome">在开始书写之前，先来设置一些基本信息吧！这些设置值之后都能再更改。<br>提醒您，若您是在App内的浏览器打开本页，建议用系统浏览器打开，避免数据遗失！</span>

			<h3>字体英文名称</h3>
			<input id="fontNameEng" type="text" placeholder="请输入英文名称" maxlength="24" />

			<h3>字体中文名称</h3>
			<input id="fontNameCJK" type="text" placeholder="请输入中文名称" maxlength="10" />
			
			<h3>缩放率</h3>
			<input id="scaleRateSlider" type="range" min="80" max="200" value="100" />
			<span id="scaleRateValue">100%</span>
			<span class="note">手写时为了避免超框，容易不经意把字写得偏小。这里可以调整文字框的尺寸。</span>

			<h3>我的字就是小</h3>
			<input id="smallModeCheck" type="checkbox" />
			<span class="note">适合写字真的很小的人。</span>

			<h3>背景格线样式</h3>
			<select id="gridTypeSelect">
				<option value="3x3grid">九宫格</option>
				<option value="3x3grid-new">新九宫格</option>
				<option value="2x2grid">田字格</option>
				<option value="stargrid">米字格</option>
				<option value="boxgrid">回字格</option>
				<option value="nogrid">无格线（仅字身框）</option>
			</select>

			<h3>中文字不等宽</h3>
			<input id="noFixedWidthFlag" type="checkbox" />
			<span class="note">设置为不等宽会更像手写字体，但可能不适合用于直排。</span>

			<h3>笔压敏感度（实验中）</h3>
			<select id="pressureEffectSelect">
				<option value="none">原始值</option>
				<option value="contrast">加大对比</option>
				<option value="enhance">增强（省力）</option>
				<option value="enhancex">再增强（更省力）</option>
			</select>
			<span class="note">本选项仅对有笔压的设备有效。目前尚在调整中，未来修改可能无法维持旧版相容性。</span>

			<h3>启用旧笔压模式（不建议）</h3>
			<input id="pressureDrawingEnabled" type="checkbox" checked />
			<span class="note">旧笔压模式无法支援笔刷功能。</span>

			<div id="div-backup">
			<br />
			<br />
			<br />
			<hr />
			<h3>完全清除字体数据</h3>
			<button id="clearAllButton">清除字体数据（无法复原！）</button>
			<br />
			<h3>导出系统事件（开发用）</h3>
			<button id="exportEventsButton">导出系统事件</button>
			<br />
			</div>
			<p class="dummy"></p>
		</div>
	</div>

	<div id="download-container" class="dialog">
		<div class="dialog-body">
			<span id="closeDownloadButton" class="close">×</span>
			<h2 id="settings-title">下载</h2>

			<h3>下载字体</h3>
			<input id="saveAsTester" type="checkbox" />
			<label for="saveAsTester">测试输出</label>
			<span class="note">勾选测试输出，字体名称会加上序号。避免系统缓存造成在电脑上无法正常安装使用的问题。</span>
			<button id="downloadFontButton">下载字体OTF档案</button><br>
			<h3>赞助作者</h3>
			字体档的权利均属于您个人，不过如果您喜欢这个工具，请<a href="https://p.ecpay.com.tw/930AED7" target="_blank">考虑赞助支持作者的开发工作</a>。您的支持将有助于未来的更新和改进！
			<br />
			<br />
			<hr />
			<h3>导入先前备份的数据</h3>
			<input type="file" id="importDataFile" accept=".txt" />
			<br />
			<h3>导出编辑中数据</h3>
			<button id="exportDataButton">备份工作中的字体数据</button>
			<br />
			<p class="dummy"></p>
		</div>
	</div>

	<!-- <div id="ads-container" class="dialog">
		<div class="dialog-body">
			<span id="closeAdsButton" class="close">×</span>
			<h2 id="settings-title">活动讯息</h2>

			<a href="https://justfont.kktix.cc/events/justlive-sp-handwriting" target="_blank"><img src="https://scontent.ftpe7-2.fna.fbcdn.net/v/t51.82787-15/524334290_18517592050031652_4988924142853493161_n.jpg?_nc_cat=111&ccb=1-7&_nc_sid=127cfc&_nc_ohc=4_f30DCJ_y0Q7kNvwFkNbFE&_nc_oc=AdmSqGxScdADdQ1NmM4kvWbBBObR-SfccZmUwTCqwKu1DdOhvnRHH_y18zX1JxoD-DE&_nc_zt=23&_nc_ht=scontent.ftpe7-2.fna&_nc_gid=Cuq19om7GhnRY_sUL_tmEQ&oh=00_AfSf_pizGvvQljo3CRD_ihar0RFIUetYs1t1GuOX094dRw&oe=6888FE13" style="width: 320px" /></a><br>
			欢迎<a href="https://justfont.kktix.cc/events/justlive-sp-handwriting" target="_blank">报名线上直播</a>，免费学习更多手写字体制作诀窍与贩售授权知识。
			<p class="dummy"></p>
		</div>
	</div> -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://opentype.js.org/dist/opentype.js"></script>
    <script src="potrace.js"></script>
	<script>
		const fdrawer = {
			dbName: 'FontDrawerDB',
			fontNameCJK: '我的手写字体',
			fontLang: 'zh-CN',
			codePage: 0x00100001,
			findMsg: '请输入要找的文字：',
			notFound: '查无此字符！',
			confirmAdd: '请问要新增到用户字表吗？',
			noDataToExport: '没有可导出的数据。',
			importConfirm: '确定要导入数据吗？这将清除目前编辑中的所有数据。',
			importDone: '导入完成。',
			clearConfirm: '确定要清除所有写过的字吗？',
			clearDone: '已清除。',
			welcomeTitle: '欢迎使用手写字体生成器！',
			settingsTitle: '字体设置',
			inAppNotice: '请使用设备浏览器打开以获得最佳使用体验。',
			customList: '用户字表'
		};
	</script>

    <script src="pressure-drawing.js"></script>
    <script src="cglyphlist.js"></script>
    <script src="fontdrawer.js"></script>
</body>
</html>
